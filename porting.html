<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>OpENer - Open Source EtherNet/IP(TM)  I/O Target Stack: Porting OpENer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpENer - Open Source EtherNet/IP(TM)  I/O Target Stack
   &#160;<span id="projectnumber">1.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('porting.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Porting OpENer </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="gen_config_section"></a>
General Stack Configuration</h1>
<p>The general stack properties have to be defined prior to building your production. This is done by providing a file called opener_user_conf.h. An example file can be found in the src/ports/platform-pc directory. The documentation of the example file for the necessary configuration options: opener_user_conf.h</p>
<h1><a class="anchor" id="startup_sec"></a>
Startup Sequence</h1>
<p>During startup of your EtherNet/IP(TM) device the following steps have to be performed:</p><ol type="1">
<li>Configure the network properties:<br />
 With the following functions the network interface of OpENer is configured:<ul>
<li>EIP_STATUS <a class="el" href="group__CIP__API.html#gabad840b9da3140beac69e9885508e96e" title="Configure the data of the network interface of the device. ">configureNetworkInterface(const char *pa_acIpAdress, const char *pa_acSubNetMask, const char *pa_acGateway)</a></li>
<li>void <a class="el" href="group__CIP__API.html#gac9a28d785b8c538fc0afdacbe92b5e27" title="Configure the MAC address of the device. ">configureMACAddress(const EIP_UINT8 *pa_acMACAddress)</a></li>
<li>void <a class="el" href="group__CIP__API.html#gaadc9d890386bdc79ccb1311ae5b5129d" title="Configure the domain name of the device. ">configureDomainName(const char *pa_acDomainName)</a></li>
<li>void <a class="el" href="group__CIP__API.html#ga66dc2aaa2cf16c7d56cadab29ca66a70" title="Configure the host name of the device. ">configureHostName(const char *pa_acHostName)</a></li>
</ul>
Depending on your platform these data can come from a configuration file or from operating system functions. If these values should be setable remotely via explicit messages the SetAttributeSingle functions of the EtherNetLink and the TCPIPInterface object have to be adapted.</li>
<li>Set the device's serial number<br />
 According to the CIP specification a device vendor has to ensure that each of its devices has a unique 32Bit device id. You can set it with the function:<ul>
<li>void <a class="el" href="group__CIP__API.html#ga4fc150ff5c679a78c16ce6d963c355c4" title="Set the serial number of the device&#39;s identity object. ">setDeviceSerialNumber(EIP_UINT32 pa_nSerialNumber)</a></li>
</ul>
</li>
<li>Initialize OpENer: <br />
 With the function <a class="el" href="group__CIP__API.html#ga8fe857c3e88bf986fda82fbac6702c9f" title="Initialize and setup the CIP-stack. ">CIP_Init(EIP_UINT16 pa_nUniqueConnID)</a> the internal data structures of opener are correctly setup. After this step own CIP objects and Assembly objects instances may be created. For your convenience we provide the call-back function <a class="el" href="group__CIP__CALLBACK__API.html#ga59b2842f01ca8f913ef0afe3f3c787aa" title="Callback for the application initialization. ">IApp_Init(void)</a>. This call back function is called when the stack is ready to receive application specific CIP objects.</li>
<li>Create Application Specific CIP Objects:<br />
 Within the call-back function <a class="el" href="group__CIP__CALLBACK__API.html#ga59b2842f01ca8f913ef0afe3f3c787aa" title="Callback for the application initialization. ">IApp_Init(void)</a> or after CIP_Init(void) has finished you may create and configure any CIP object or Assembly object instances. See the module <a class="el" href="group__CIP__API.html">OpENer User interface</a> for available functions. Currently no functions are available to remove any created objects or instances. This is planned for future versions.</li>
<li>Setup the listening TCP and UDP port:<br />
 THE ETHERNET/IP SPECIFICATION demands from devices to listen to TCP connections and UDP datagrams on the port AF12hex for explicit messages. Therefore before going into normal operation you need to configure your network library so that TCP and UDP messages on this port will be received and can be hand over to the Ethernet encapsulation layer.</li>
</ol>
<h1><a class="anchor" id="normal_op_sec"></a>
Normal Operation</h1>
<p>During normal operation the following tasks have to be done by the platform specific code:</p><ul>
<li>Establish connections requested on TCP port AF12hex</li>
<li>Receive explicit message data on connected TCP sockets and the UPD socket for port AF12hex. The received data has to be hand over to Ethernet encapsulation layer with the functions: <br />
 int handleReceivedExplictTCPData(int pa_socket, EIP_UINT8* pa_buf, int pa_length, int *pa_nRemainingBytes),<br />
 int handleReceivedExplictUDPData(int pa_socket, struct <a class="el" href="structsockaddr__in.html">sockaddr_in</a> <em>pa_pstFromAddr, EIP_UINT8</em> pa_buf, unsigned int pa_length, int *pa_nRemainingBytes).<br />
 Depending if the data has been received from a TCP or from a UDP socket. As a result of this function a response may have to be sent. The data to be sent is in the given buffer pa_buf.</li>
<li>Create UDP sending and receiving sockets for implicit connected messages<br />
 OpENer will use to call-back function int <a class="el" href="group__CIP__CALLBACK__API.html#ga9d7f3bd3280b10ad3cc4ed2f5dc9c339" title="create a producing or consuming UDP socket ">IApp_CreateUDPSocket(int pa_nDirection, struct sockaddr_in *pa_pstAddr)</a> for informing the platform specific code that a new connection is established and new sockets are necessary</li>
<li>Receive implicit connected data on a receiving UDP socket<br />
 The received data has to be hand over to the Connection Manager Object with the function EIP_STATUS handleReceivedConnectedData(EIP_UINT8 *pa_pnData, int pa_nDataLength)</li>
<li>Close UDP and TCP sockets:<ol type="1">
<li>Requested by OpENer through the call back function: void <a class="el" href="group__CIP__CALLBACK__API.html#ga26bdb2c504bbf917225a56b6b1c31af0" title="Close the given socket and clean up the stack. ">IApp_CloseSocket(int pa_nSockFd)</a></li>
<li>For TCP connection when the peer closed the connection OpENer needs to be informed to clean up internal data structures. This is done with the function void <a class="el" href="group__CIP__API.html#gaabf704af111d213b94f459b8a34c7886" title="Inform the encapsulation layer that the remote host has closed the connection. ">closeSession(int pa_nSocket)</a>.</li>
</ol>
</li>
<li>Cyclically update the connection status:<br />
 In order that OpENer can determine when to produce new data on connections or that a connection timed out every <a class="el" href="WIN32_2sample__application_2opener__user__conf_8h.html#a72f913dfb4303ff1c1e6897b6a121a01">OPENER_TIMER_TICK</a> ms the function EIP_STATUS <a class="el" href="group__CIP__API.html#gace7c63372afe915e306b62919dfc0b68" title="Check if any of the connection timers (TransmissionTrigger or WarchdogTimeout) have timed out...">manageConnections(void)</a> has to be called.</li>
</ul>
<h1><a class="anchor" id="callback_funcs_sec"></a>
Callback Functions</h1>
<p>In order to make OpENer more platform independent and in order to inform the application on certain state changes and actions within the stack a set of call-back functions is provided. These call-back functions are declared in the file <a class="el" href="opener__api_8h.html">opener_api.h</a> and have to be implemented by the application specific code. An overview and explanation of OpENer's call-back API may be found in the module <a class="el" href="group__CIP__CALLBACK__API.html">Callback Functions Demanded by OpENer</a>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Oct 20 2015 10:08:29 for OpENer - Open Source EtherNet/IP(TM)  I/O Target Stack by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
